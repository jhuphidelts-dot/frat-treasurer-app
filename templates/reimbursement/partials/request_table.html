<!-- Reimbursement Requests Table -->
<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Date</th>
                        <th>Member</th>
                        <th>Category</th>
                        <th>Amount</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Priority</th>
                        {% if has_permission('approve_reimbursements') %}
                        <th>Actions</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% set display_requests = pending_requests if pending_requests is defined 
                                              else approved_requests if approved_requests is defined 
                                              else rejected_requests if rejected_requests is defined 
                                              else requests %}
                    {% for request in display_requests %}
                    <tr>
                        <td>
                            <div class="d-flex flex-column">
                                <span class="fw-bold">{{ request.created_at.strftime('%m/%d/%Y') }}</span>
                                <small class="text-muted">{{ request.created_at.strftime('%I:%M %p') }}</small>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex flex-column">
                                <span class="fw-bold">User ID: {{ request.requested_by }}</span>
                                <small class="text-muted">Request #{{ request.id }}</small>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-light text-dark">{{ request.category }}</span>
                        </td>
                        <td>
                            <span class="fw-bold text-success">${{ "{:,.2f}".format(request.amount) }}</span>
                            <br><small class="text-muted">Submitted: {{ request.created_at.strftime('%m/%d/%Y') }}</small>
                        </td>
                        <td>
                            <div style="max-width: 200px;">
                                <span class="text-truncate d-block" title="{{ request.purpose }}">
                                    {{ request.purpose }}
                                </span>
                                {% if request.receipt_filename %}
                                <small class="text-info">
                                    <i class="bi bi-paperclip"></i> Receipt attached
                                </small>
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            {% if request.status == 'pending' %}
                                <span class="badge bg-warning">
                                    <i class="bi bi-clock"></i> Pending
                                </span>
                            {% elif request.status == 'approved' %}
                                <span class="badge bg-success">
                                    <i class="bi bi-check-circle"></i> Approved
                                </span>
                                {% if request.reviewed_by %}
                                <br><small class="text-muted">by User {{ request.reviewed_by }}</small>
                                {% endif %}
                            {% elif request.status == 'rejected' %}
                                <span class="badge bg-danger">
                                    <i class="bi bi-x-circle"></i> Rejected
                                </span>
                                {% if request.reviewed_by %}
                                <br><small class="text-muted">by User {{ request.reviewed_by }}</small>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td>
                            {% if request.priority == 'urgent' %}
                                <span class="badge bg-danger">Urgent</span>
                            {% elif request.priority == 'high' %}
                                <span class="badge bg-warning">High</span>
                            {% else %}
                                <span class="badge bg-secondary">Normal</span>
                            {% endif %}
                        </td>
                        {% if has_permission('approve_reimbursements') %}
                        <td>
                            <div class="btn-group" role="group">
                                <a href="{{ url_for('reimbursement.view_reimbursement', id=request.id) }}" 
                                   class="btn btn-sm btn-outline-primary" title="View Details">
                                    <i class="bi bi-eye"></i>
                                </a>
                                {% if request.status == 'pending' %}
                                <button class="btn btn-sm btn-success approve-btn" 
                                        data-bs-toggle="modal" data-bs-target="#approveModal"
                                        data-id="{{ request.id }}"
                                        data-amount="{{ request.amount }}"
                                        data-description="{{ request.purpose }}"
                                        data-member="User {{ request.requested_by }}"
                                        title="Approve">
                                    <i class="bi bi-check"></i>
                                </button>
                                <button class="btn btn-sm btn-danger reject-btn"
                                        data-bs-toggle="modal" data-bs-target="#rejectModal"
                                        data-id="{{ request.id }}"
                                        data-amount="{{ request.amount }}"
                                        data-description="{{ request.purpose }}"
                                        data-member="User {{ request.requested_by }}"
                                        title="Reject">
                                    <i class="bi bi-x"></i>
                                </button>
                                {% endif %}
                                {% if request.receipt_filename %}
                                <a href="{{ url_for('reimbursement.view_receipt', id=request.id) }}" 
                                   class="btn btn-sm btn-outline-info" title="View Receipt" target="_blank">
                                    <i class="bi bi-paperclip"></i>
                                </a>
                                {% endif %}
                            </div>
                        </td>
                        {% endif %}
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="{% if has_permission('approve_reimbursements') %}8{% else %}7{% endif %}" 
                            class="text-center text-muted py-4">
                            <i class="bi bi-inbox fs-1"></i>
                            <div class="mt-2">No reimbursement requests found</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% if display_requests %}
<!-- Pagination could go here if needed -->
<div class="d-flex justify-content-between align-items-center mt-3">
    <div class="text-muted">
        Showing {{ display_requests|length }} request{{ 's' if display_requests|length != 1 else '' }}
    </div>
    <div>
        <!-- Future pagination controls -->
    </div>
</div>
{% endif %}